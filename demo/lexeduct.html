<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Lexeduct</title>
</head>
<body>

<header>
  <h1>Lexeduct</h1>
</header>

<div id="container"></div>

</body>
<script src="lexeduct-browser.js"></script>
<script src="yoob/element-factory.js"></script>
<script>
"use strict";

var compose = function(g, f) {
    return function(str, data) {
        str = f(str, data);
        return g(str, data);
    };
};

var container, input, output, processButton, tranformersPanel;

container = document.getElementById('container');
input = yoob.makeTextArea(container, 40, 20, "Hello, there!\nWhat do you think?");

var transformersPanel = yoob.makeDiv(container);
transformersPanel.style.border = "2px solid black";
transformersPanel.style.display = "inline-block";
transformersPanel.style.verticalAlign = "top";

var transformerNames = [["identity", "---"]];
for (var key in transformer) {
    if (key !== 'identity' && transformer.hasOwnProperty(key)) {
        transformerNames.push([key, key]);
    }
}

var MAX_TRANSFORMERS = 8; // TODO dynamic
var transformerSelects = [];

for (var i = 0; i < MAX_TRANSFORMERS; i++) {
    var select = yoob.makeSelect(
        transformersPanel, "Transformer " + (i+1), transformerNames
    );
    transformerSelects.push(select);
    yoob.makeLineBreak(transformersPanel);
    yoob.makeTextInput(transformersPanel, 24);
    yoob.makeLineBreak(transformersPanel);
}

processButton = yoob.makeButton(transformersPanel, "Process", function() {
    var t = transformer['identity'].makeTransformer({});
    for (var i = 0; i < transformerSelects.length; i++) {
        var select = transformerSelects[i];
        var transformerName = select.options[select.selectedIndex].value;
        var t2 = transformer[transformerName].makeTransformer({chars: 'a'});
        t = compose(t2, t);
    }
    output.value = t(input.value);
});

output = yoob.makeTextArea(container, 40, 20);
</script>
